import{S as Be,i as Ie,s as Le,y as K,e as v,u as M,c as V,g as P,f as w,h as N,j as m,w as H,t as F,B as Ne,C as qe,l as Y,n as I,D as ne,E as ce,b as $,a as fe,d as x,m as ee,A as G,k as de,o as te,a7 as se,K as Je,J as me,p as Me,a2 as Pe,a8 as Fe,F as De,a4 as Ke,q as _e,a3 as Ue,v as Ye,R as ze,a6 as He,M as pe,z as Ge}from"./encryption-f5875568.js";import{S as Qe,a as We,D as Xe,T as Ze,v as $e,V as xe,c as et}from"./VideoClipSelector-3aff0440.js";import{g as tt}from"./globals-7f7f1b26.js";const{Boolean:nt}=tt;function he(e,s,n){const t=e.slice();t[25]=s[n],t[30]=s,t[31]=n;const r=t[8][t[31]];t[26]=r;const f=t[7][t[31]];t[27]=f;const a=t[12].bind(null,t[31]);t[28]=a;const l=t[25].annotator===t[1];return t[29]=l,t}function ge(e){let s,n=se(e[25].timestamp.start)+"",t,r,f=" ",a,l,u=se(e[25].timestamp.end)+"",i;return{c(){s=v("h1"),t=M(n),r=M(" -"),a=M(f),l=V(),i=M(u)},m(_,h){N(_,s,h),m(s,t),m(s,r),m(s,a),m(s,l),m(s,i)},p(_,h){h[0]&32&&n!==(n=se(_[25].timestamp.start)+"")&&G(t,n),h[0]&32&&u!==(u=se(_[25].timestamp.end)+"")&&G(i,u)},d(_){_&&I(s)}}}function be(e){let s,n,t,r;function f(){e[19].call(n,e[31])}function a(){return e[20](e[31])}return{c(){s=M(`Agree?
                        `),n=v("input"),P(n,"type","checkbox"),P(n,"class","checkbox")},m(l,u){N(l,s,u),N(l,n,u),n.checked=e[9][e[31]],t||(r=[H(n,"change",f),H(n,"input",a)],t=!0)},p(l,u){e=l,u[0]&512&&(n.checked=e[9][e[31]])},d(l){l&&(I(s),I(n)),t=!1,ce(r)}}}function ve(e){let s,n=e[31],t;const r=()=>e[21](s,n),f=()=>e[21](null,n);let a={showAnnotations:!1,clipStart:e[25].timestamp.start,clipEnd:e[25].timestamp.end};return s=new xe({props:a}),r(),{c(){x(s.$$.fragment)},m(l,u){ee(s,l,u),t=!0},p(l,u){n!==l[31]&&(f(),n=l[31],r());const i={};u[0]&32&&(i.clipStart=l[25].timestamp.start),u[0]&32&&(i.clipEnd=l[25].timestamp.end),s.$set(i)},i(l){t||(F(s.$$.fragment,l),t=!0)},o(l){Y(s.$$.fragment,l),t=!1},d(l){f(),te(s,l)}}}function we(e){let s,n,t,r,f,a=e[25].annotator+"",l,u=e[29]?" (You)":"",i,_,h,d,C,c,R,b,S,k,B,O,E,A,Q,Z,U,J,W,o,p,g=e[25].timestamp&&ge(e),y=!e[29]&&be(e),j=e[3]&&ve(e);function z(...T){return e[22](e[31],...T)}b=new Qe({props:{annotation:e[25]}}),b.$on("change",z),B=new We({props:{annotation:e[25],type:e[27],fit:!0}}),B.$on("input",e[28]);function X(T){e[23](T,e[31])}let q={annotation:e[25]};e[11].decisionRadio[e[31]]!==void 0&&(q.reset=e[11].decisionRadio[e[31]]),A=new Xe({props:q}),$.push(()=>fe(A,"reset",X)),A.$on("change",e[28]);function D(T){e[24](T,e[31])}let ie={annotation:e[25],disabled:e[26]};return e[11].attributes[e[31]]!==void 0&&(ie.reset=e[11].attributes[e[31]]),J=new Ze({props:ie}),$.push(()=>fe(J,"reset",D)),J.$on("update",e[28]),{c(){s=v("div"),n=v("center"),g&&g.c(),t=V(),r=v("h1"),f=M("Annotator: "),l=M(a),i=M(u),_=V(),y&&y.c(),h=V(),d=v("center"),j&&j.c(),C=V(),c=v("div"),R=v("div"),x(b.$$.fragment),S=V(),k=v("div"),x(B.$$.fragment),O=V(),E=v("div"),x(A.$$.fragment),Z=V(),U=v("div"),x(J.$$.fragment),o=V(),w(r,"font-weight","bold"),w(d,"width","90%"),w(R,"grid-column",1),w(R,"grid-row",2),w(k,"grid-column",2),w(k,"grid-row",2),w(E,"grid-column","1/3"),w(E,"grid-row",3),w(U,"grid-column","1/3"),w(U,"grid-row",4),P(c,"class","container svelte-2g1eof"),w(s,"display","flex"),w(s,"flex-direction","column"),w(s,"margin","20px")},m(T,L){N(T,s,L),m(s,n),g&&g.m(n,null),m(n,t),m(n,r),m(r,f),m(r,l),m(r,i),m(n,_),y&&y.m(n,null),m(s,h),m(s,d),j&&j.m(d,null),m(s,C),m(s,c),m(c,R),ee(b,R,null),m(c,S),m(c,k),ee(B,k,null),m(c,O),m(c,E),ee(A,E,null),m(c,Z),m(c,U),ee(J,U,null),m(s,o),p=!0},p(T,L){e=T,e[25].timestamp?g?g.p(e,L):(g=ge(e),g.c(),g.m(n,t)):g&&(g.d(1),g=null),(!p||L[0]&32)&&a!==(a=e[25].annotator+"")&&G(l,a),(!p||L[0]&34)&&u!==(u=e[29]?" (You)":"")&&G(i,u),e[29]?y&&(y.d(1),y=null):y?y.p(e,L):(y=be(e),y.c(),y.m(n,null)),e[3]?j?(j.p(e,L),L[0]&8&&F(j,1)):(j=ve(e),j.c(),F(j,1),j.m(d,null)):j&&(Ne(),Y(j,1,1,()=>{j=null}),qe());const ue={};L[0]&32&&(ue.annotation=e[25]),b.$set(ue);const oe={};L[0]&32&&(oe.annotation=e[25]),L[0]&128&&(oe.type=e[27]),B.$set(oe);const ae={};L[0]&32&&(ae.annotation=e[25]),!Q&&L[0]&2048&&(Q=!0,ae.reset=e[11].decisionRadio[e[31]],de(()=>Q=!1)),A.$set(ae);const le={};L[0]&32&&(le.annotation=e[25]),L[0]&256&&(le.disabled=e[26]),!W&&L[0]&2048&&(W=!0,le.reset=e[11].attributes[e[31]],de(()=>W=!1)),J.$set(le)},i(T){p||(F(j),F(b.$$.fragment,T),F(B.$$.fragment,T),F(A.$$.fragment,T),F(J.$$.fragment,T),p=!0)},o(T){Y(j),Y(b.$$.fragment,T),Y(B.$$.fragment,T),Y(A.$$.fragment,T),Y(J.$$.fragment,T),p=!1},d(T){T&&I(s),g&&g.d(),y&&y.d(),j&&j.d(),te(b),te(B),te(A),te(J)}}}function lt(e){let s,n,t,r,f,a,l,u,i,_,h,d,C=K(e[5]),c=[];for(let b=0;b<C.length;b+=1)c[b]=we(he(e,C,b));const R=b=>Y(c[b],1,1,()=>{c[b]=null});return{c(){s=v("div"),n=v("center"),t=v("button"),r=M("Submit"),a=V(),l=v("button"),l.textContent="Reset",u=V(),i=v("div");for(let b=0;b<c.length;b+=1)c[b].c();P(t,"class","btn"),t.disabled=f=!e[6].every(Boolean),P(l,"class","btn"),w(i,"width","100%"),w(i,"display","flex"),w(i,"flex-direction","row")},m(b,S){N(b,s,S),m(s,n),m(n,t),m(t,r),m(n,a),m(n,l),m(s,u),m(s,i);for(let k=0;k<c.length;k+=1)c[k]&&c[k].m(i,null);_=!0,h||(d=[H(t,"click",e[17]),H(l,"click",e[18])],h=!0)},p(b,S){if((!_||S[0]&64&&f!==(f=!b[6].every(Boolean)))&&(t.disabled=f),S[0]&32682){C=K(b[5]);let k;for(k=0;k<C.length;k+=1){const B=he(b,C,k);c[k]?(c[k].p(B,S),F(c[k],1)):(c[k]=we(B),c[k].c(),F(c[k],1),c[k].m(i,null))}for(Ne(),k=C.length;k<c.length;k+=1)R(k);qe()}},i(b){if(!_){for(let S=0;S<C.length;S+=1)F(c[S]);_=!0}},o(b){c=c.filter(nt);for(let S=0;S<c.length;S+=1)Y(c[S]);_=!1},d(b){b&&I(s),ne(c,b),h=!1,ce(d)}}}function st(e,s,n){let{originals:t}=s,{name:r}=s,{submit:f}=s,a=!1;const l=()=>{n(3,a=!0)};let u=JSON.stringify(t),i=t.map(Ve),_=i.map(o=>!0),h=new Array(...i.map(o=>"error")),d=i.map(o=>!1),C=i.map(o=>{var p;return((p=o==null?void 0:o.agreement)==null?void 0:p.includes(r))??!1}),c=i.map(o=>null);const R={attributes:i.map(o=>null),decisionRadio:i.map(o=>null)},b=o=>{n(6,_[o]=$e(i[o]),_),n(6,_)},S=(o,p)=>{const g=i[p].selections[o];o==="isPerformance"?(n(8,d[p]=g,d),n(8,d)):o==="isCompotence"&&(n(7,h[p]=g?"competence":"error",h),n(7,h))},k=(o,p)=>{var g;n(5,(g=i[o]).agreement??(g.agreement=[]),i),p?i[o].agreement.includes(r)||i[o].agreement.push(r):n(5,i[o].agreement=i[o].agreement.filter(y=>y!==r),i)},B=()=>u!==JSON.stringify(i),O=()=>{for(let o=0;o<i.length;o++){if(!c[o])continue;const{clipStart:p,clipEnd:g}=c[o].getClip();n(5,i[o].timestamp.start=p,i),n(5,i[o].timestamp.end=g,i)}n(4,u=JSON.stringify(i)),f(i)},E=()=>n(5,i=t.map(Ve));function A(o){C[o]=this.checked,n(9,C)}const Q=o=>k(o,!C[o]);function Z(o,p){$[o?"unshift":"push"](()=>{c[p]=o,n(10,c)})}const U=(o,{detail:p})=>S(p,o);function J(o,p){e.$$.not_equal(R.decisionRadio[p],o)&&(R.decisionRadio[p]=o,n(11,R))}function W(o,p){e.$$.not_equal(R.attributes[p],o)&&(R.attributes[p]=o,n(11,R))}return e.$$set=o=>{"originals"in o&&n(0,t=o.originals),"name"in o&&n(1,r=o.name),"submit"in o&&n(2,f=o.submit)},[t,r,f,a,u,i,_,h,d,C,c,R,b,S,k,l,B,O,E,A,Q,Z,U,J,W]}class it extends Be{constructor(s){super(),Ie(this,s,st,lt,Le,{originals:0,name:1,submit:2,setVideoReady:15,hasChanges:16},null,[-1,-1])}get setVideoReady(){return this.$$.ctx[15]}get hasChanges(){return this.$$.ctx[16]}}function ke(e,s,n){const t=e.slice();t[26]=s[n],t[28]=n;const r=t[28]===0;return t[7]=r,t}function ye(e,s,n){const t=e.slice();t[29]=s[n],t[32]=n;const r=t[32]===0?"empathic":"wellness";return t[30]=r,t}function Ce(e,s,n){const t=e.slice();t[33]=s[n];const r=t[11](t[29],t[33]);return t[34]=r,t}function Re(e,s,n){const t=e.slice();t[37]=s[n];const r=t[8](t[28],t[32],t[33],t[37]);t[38]=r;const f=t[38]===t[3];t[39]=f;const a=function(){return e[17](t[29],t[33],t[37],t[30],t[7],t[38])};t[40]=a;const l=t[10](t[29],t[33],t[37]);return t[41]=l,t}function Se(e){let s,n=K([[e[7].empathic,e[7].wellness],[e[2].empathic,e[2].wellness]]),t=[];for(let r=0;r<2;r+=1)t[r]=Ae(ke(e,n,r));return{c(){for(let r=0;r<2;r+=1)t[r].c();s=De()},m(r,f){for(let a=0;a<2;a+=1)t[a]&&t[a].m(r,f);N(r,s,f)},p(r,f){if(f[0]&8076){n=K([[r[7].empathic,r[7].wellness],[r[2].empathic,r[2].wellness]]);let a;for(a=0;a<2;a+=1){const l=ke(r,n,a);t[a]?t[a].p(l,f):(t[a]=Ae(l),t[a].c(),t[a].m(s.parentNode,s))}for(;a<2;a+=1)t[a].d(1)}},d(r){r&&I(s),ne(t,r)}}}function je(e){let s,n,t,r=e[37]+"",f,a,l=e[41]?"✓":"",u,i,_;return{c(){s=v("ul"),n=v("li"),t=v("button"),f=M(r),a=V(),u=M(l),pe(t,"bg-accent",e[39])},m(h,d){N(h,s,d),m(s,n),m(n,t),m(t,f),m(t,a),m(t,u),i||(_=H(t,"click",function(){Ge(e[40])&&e[40].apply(this,arguments)}),i=!0)},p(h,d){e=h,d[0]&132&&r!==(r=e[37]+"")&&G(f,r),d[0]&132&&l!==(l=e[41]?"✓":"")&&G(u,l),d[0]&396&&pe(t,"bg-accent",e[39])},d(h){h&&I(s),i=!1,_()}}}function Ee(e){let s,n,t,r,f=e[34]?"✓":"",a,l=e[12](e[33])+"",u,i,_=K(Object.keys(e[29][e[33]])),h=[];for(let d=0;d<_.length;d+=1)h[d]=je(Re(e,_,d));return{c(){s=v("ul"),n=v("li"),t=v("details"),r=v("summary"),a=M(f),u=M(l),i=V();for(let d=0;d<h.length;d+=1)h[d].c()},m(d,C){N(d,s,C),m(s,n),m(n,t),m(t,r),m(r,a),m(r,u),m(t,i);for(let c=0;c<h.length;c+=1)h[c]&&h[c].m(t,null)},p(d,C){if(C[0]&132&&f!==(f=d[34]?"✓":"")&&G(a,f),C[0]&132&&l!==(l=d[12](d[33])+"")&&G(u,l),C[0]&1932){_=K(Object.keys(d[29][d[33]]));let c;for(c=0;c<_.length;c+=1){const R=Re(d,_,c);h[c]?h[c].p(R,C):(h[c]=je(R),h[c].c(),h[c].m(t,null))}for(;c<h.length;c+=1)h[c].d(1);h.length=_.length}},d(d){d&&I(s),ne(h,d)}}}function Oe(e){let s,n,t,r,f=K(Object.keys(e[29])),a=[];for(let l=0;l<f.length;l+=1)a[l]=Ee(Ce(e,f,l));return{c(){s=v("li"),n=v("details"),t=v("summary"),t.textContent=`${e[30]}`,r=V();for(let l=0;l<a.length;l+=1)a[l].c()},m(l,u){N(l,s,u),m(s,n),m(n,t),m(n,r);for(let i=0;i<a.length;i+=1)a[i]&&a[i].m(n,null)},p(l,u){if(u[0]&8076){f=K(Object.keys(l[29]));let i;for(i=0;i<f.length;i+=1){const _=Ce(l,f,i);a[i]?a[i].p(_,u):(a[i]=Ee(_),a[i].c(),a[i].m(n,null))}for(;i<a.length;i+=1)a[i].d(1);a.length=f.length}},d(l){l&&I(s),ne(a,l)}}}function Ae(e){let s,n,t,r,f=K(e[26]),a=[];for(let l=0;l<f.length;l+=1)a[l]=Oe(ye(e,f,l));return{c(){s=v("h1"),s.textContent=`${e[7]?"Includes you":"Excludes you"}`,n=V(),t=v("ul");for(let l=0;l<a.length;l+=1)a[l].c();r=V(),w(s,"padding-left","10px"),P(t,"class","menu"),w(t,"overflow-y","scroll"),w(t,"max-height","100%"),w(t,"width","100%")},m(l,u){N(l,s,u),N(l,n,u),N(l,t,u);for(let i=0;i<a.length;i+=1)a[i]&&a[i].m(t,null);m(t,r)},p(l,u){if(u[0]&8076){f=K(l[26]);let i;for(i=0;i<f.length;i+=1){const _=ye(l,f,i);a[i]?a[i].p(_,u):(a[i]=Oe(_),a[i].c(),a[i].m(t,r))}for(;i<a.length;i+=1)a[i].d(1);a.length=f.length}},d(l){l&&(I(s),I(n),I(t)),ne(a,l)}}}function ot(e){let s,n,t,r,f,a,l,u,i,_,h=!1,d,C,c,R,b,S,k;function B(){cancelAnimationFrame(d),_.paused||(d=He(B),h=!0),e[16].call(_)}let O=e[7]&&e[2]&&Se(e);return{c(){s=v("link"),n=v("script"),n.innerHTML="",r=V(),f=v("input"),a=V(),l=v("div"),u=v("div"),i=v("div"),_=v("video"),C=V(),c=v("div"),O&&O.c(),R=V(),b=v("div"),P(s,"href","https://cdn.jsdelivr.net/npm/daisyui@2.11.0/dist/full.css"),P(s,"rel","stylesheet"),P(s,"type","text/css"),Je(n.src,t="https://cdn.tailwindcss.com")||P(n,"src",t),P(f,"type","file"),P(f,"accept",".webm"),w(f,"visibility","hidden"),_.controls=!0,w(i,"width","100%"),w(c,"flex-grow","1"),w(c,"min-height","50%"),w(c,"width","100%"),w(u,"min-width","300px"),w(u,"max-width","300px"),w(u,"height","100vh"),w(u,"display","flex"),w(u,"flex-direction","column"),w(l,"display","flex"),w(l,"flex-direction","row"),w(l,"width","100vw"),w(l,"height","100%"),w(l,"padding","0"),w(l,"margin","0")},m(E,A){m(document.head,s),m(document.head,n),N(E,r,A),N(E,f,A),e[13](f),N(E,a,A),N(E,l,A),m(l,u),m(u,i),m(i,_),e[15](_),m(u,C),m(u,c),O&&O.m(c,null),m(l,R),m(l,b),e[18](b),S||(k=[H(f,"change",e[14]),H(_,"encrypted",Ke),H(_,"timeupdate",B)],S=!0)},p(E,A){!h&&A[0]&64&&!isNaN(E[6])&&(_.currentTime=E[6]),h=!1,E[7]&&E[2]?O?O.p(E,A):(O=Se(E),O.c(),O.m(c,null)):O&&(O.d(1),O=null)},i:me,o:me,d(E){E&&(I(r),I(f),I(a),I(l)),I(s),I(n),e[13](null),e[15](null),O&&O.d(),e[18](null),S=!1,ce(k)}}}const Te=["avery","zahra","dennison"],Ve=e=>{const s=et(e);return s.annotator=e.annotator,e.agreement&&(s.agreement=[...e.agreement??[]]),s},re="http://localhost:8000";function at(e,s,n){let t;Me(e,_e,o=>n(6,t=o));let r,f,a="",l,u,i,_,h,d;const C=new URLSearchParams(window.location.search),c=C.get("ek");c&&Pe.set(c);const R=C.get("name");if(!Te.includes(R))throw alert(`Invalid annotator name. Make sure to include the 'name' url parameter. Valid options: ${Te.join(", ")}`),new Error("Invalid annotator name");const b=(o,p)=>{const g={};for(const y in o){g[y]={};for(const j in o[y]){const z=o[y][j],X=z.findIndex(q=>q.annotator===R);(p&&X!==-1||!p&&X===-1)&&(g[y][j]=z)}Object.keys(g[y]).length===0&&delete g[y]}return g};Fe(async()=>{const[o,p]=await Promise.all(["empathic","wellness"].map(g=>fetch(`${re}/${g}.json`).then(y=>y.json())));n(7,r={empathic:b(o,!0),wellness:b(p,!0)}),n(2,f={empathic:b(o,!1),wellness:b(p,!1)})});const S=(o,p,g,y)=>`${o}-${p}-${g}-${y}`,k=(o,p,g,y,j,z)=>{if(u!=null&&u.hasChanges()&&!confirm("You have unsaved changes. Continue?"))return;n(3,a=z),u==null||u.$destroy(),fetch(`${re}/${p}.webm`).then(q=>{q.ok?q.json().then(({filename:D})=>{D!==h&&(h=D,i.click())}):console.log("Backend could not find the video file")}),u=new it({target:l,props:{name:R,originals:o[p][g].filter(q=>typeof q!="boolean").sort((q,D)=>q.annotator===R?-1:D.annotator===R?1:q.annotator.localeCompare(D.annotator)),submit:async q=>{const D=[...q,!0];(await fetch(`${re}/data.json`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:y,key:p,id:g,payload:D})})).ok?(o[p][g]=D,j?n(7,r):n(2,f)):alert("Failed to submit annotations")}}});const X=()=>{u.setVideoReady(),d.removeEventListener("canplay",X)};d.addEventListener("canplay",X)},B=(o,p,g)=>o[p][g].at(-1)===!0,O=(o,p)=>Object.keys(o[p]).every(g=>B(o,p,g)),E=o=>{let p=o.replace("wellness2_participant","").replace("_typeA","");const g=p.split("_");return g.length<=2?p:g.slice(0,2).join("_")};function A(o){$[o?"unshift":"push"](()=>{i=o,n(5,i)})}function Q(){_=this.files,n(0,_)}function Z(o){$[o?"unshift":"push"](()=>{d=o,n(1,d),n(0,_)})}function U(){t=this.currentTime,_e.set(t)}const J=(o,p,g,y,j,z)=>k(o,p,g,y,j,z);function W(o){$[o?"unshift":"push"](()=>{l=o,n(4,l)})}return e.$$.update=()=>{e.$$.dirty[0]&1&&_&&n(1,d.src=URL.createObjectURL(_[0]),d),e.$$.dirty[0]&2&&d&&(Ue(d),n(1,d.oncanplay=()=>{Ye.set(d),ze.set(d.duration)},d))},[_,d,f,a,l,i,t,r,S,k,B,O,E,A,Q,Z,U,J,W]}class rt extends Be{constructor(s){super(),Ie(this,s,at,ot,Le,{},null,[-1,-1])}}new rt({target:document.getElementById("app")});
